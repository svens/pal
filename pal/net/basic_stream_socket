#pragma once // -*- C++ -*-

/**
 * \file pal/net/basic_stream_socket
 * Generic stream-oriented socket
 */

#include <pal/net/basic_socket>

namespace pal::net {

template <typename Protocol>
class basic_stream_socket: public basic_socket<Protocol>
{
public:

	using typename basic_socket<Protocol>::protocol_type;
	using typename basic_socket<Protocol>::endpoint_type;

private:

	using basic_socket<Protocol>::basic_socket;

	template <typename P>
	friend result<basic_stream_socket<P>> make_stream_socket (const P &) noexcept;
};

/// Create new stream socket of \a Protocol
template <typename Protocol>
result<basic_stream_socket<Protocol>> make_stream_socket (const Protocol &protocol) noexcept
{
	using socket_type = basic_stream_socket<Protocol>;
	static const auto to_impl = [](auto &&value)
	{
		return socket_type{std::move(value)};
	};
	return socket_type::open(protocol.family(), protocol.type(), protocol.protocol()).transform(to_impl);
}

} // namespace pal::net
