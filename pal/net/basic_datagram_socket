#pragma once // -*- C++ -*-

/**
 * \file pal/net/basic_datagram_socket
 * Generic datagram-oriented socket
 */

#include <pal/net/basic_socket>

namespace pal::net {

template <typename Protocol>
class basic_datagram_socket: public basic_socket<Protocol>
{
public:

	using typename basic_socket<Protocol>::protocol_type;
	using typename basic_socket<Protocol>::endpoint_type;
};

/// Create new datagram socket of \a Protocol
template <typename Protocol>
result<basic_datagram_socket<Protocol>> make_datagram_socket (const Protocol &protocol) noexcept
{
	return open(protocol.family(), protocol.type(), protocol.protocol())
		.transform(socket_base::to_api<basic_datagram_socket<Protocol>>())
	;
}

/// Create new datagram socket of \a Protocol and bind to \a endpoint
template <typename Protocol>
result<basic_datagram_socket<Protocol>> make_datagram_socket (
	const Protocol &protocol,
	const typename Protocol::endpoint &endpoint) noexcept
{
	if (auto socket = make_datagram_socket(protocol); !socket)
	{
		return unexpected{socket.error()};
	}
	else if (auto bind = socket->bind(endpoint); !bind)
	{
		return unexpected{bind.error()};
	}
	else
	{
		return socket;
	}
}

} // namespace pal::net
